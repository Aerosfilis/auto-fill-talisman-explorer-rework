<!-- Load DATA first -->
<script src="https://aevanko.github.io/talisman-explorer/data.js?v=1"></script>

<!-- Then run the skills page code -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  if (!window.DATA) {
    document.body.innerHTML =
      "<p style='color:#f88;padding:20px;font-family:monospace'>" +
      "ERROR: data.js not found. Put your DATA object into data.js and include it before this script." +
      "</p>";
    return;
  }

  // 1) Build "All Skills & Levels"
  const allTbody = document.querySelector('#allSkills tbody');
  const entries = Object.entries(DATA.levelsByName || {}).sort((a, b) => a[0].localeCompare(b[0]));
  for (const [name, levels] of entries) {
    const tr = document.createElement('tr');
    const tdName = document.createElement('td');
    tdName.textContent = name;
    const tdLvls = document.createElement('td');
    tdLvls.textContent = Array.isArray(levels) ? levels.join(", ") : "";
    tr.appendChild(tdName);
    tr.appendChild(tdLvls);
    allTbody.appendChild(tr);
  }
  document.getElementById('skillCount').textContent = entries.length + " skills";

  // 2) Build Group cards
  const groupGrid = document.getElementById('groupGrid');
  const groups = DATA.groups || {};
  const groupNames = Object.keys(groups).sort((a, b) => {
    const na = parseInt((a.match(/\d+/) || [])[0] || "9999", 10);
    const nb = parseInt((b.match(/\d+/) || [])[0] || "9999", 10);
    return na - nb || a.localeCompare(b);
  });

  for (const g of groupNames) {
    const arr = groups[g] || [];
    const map = new Map();
    for (const it of arr) {
      if (!it || !it.name) continue;
      if (!map.has(it.name)) map.set(it.name, new Set());
      if (typeof it.level === "number") map.get(it.name).add(it.level);
    }

    const card = document.createElement('div');
    card.className = 'section-card';
    const h3 = document.createElement('h3');
    h3.textContent = g + " ";
    const pill = document.createElement('span');
    pill.className = 'pill';
    pill.textContent = map.size + " skills";
    h3.appendChild(pill);
    card.appendChild(h3);

    const table = document.createElement('table');
    table.innerHTML = "<thead><tr><th>Skill</th><th>Levels in this Group</th></tr></thead>";
    const tbody = document.createElement('tbody');

    const rows = Array.from(map.entries())
      .map(([name, set]) => ({
        name,
        levels: Array.from(set).sort((a, b) => a - b).join(", ")
      }))
      .sort((a, b) => a.name.localeCompare(b.name));

    for (const r of rows) {
      const tr = document.createElement('tr');
      const td1 = document.createElement('td');
      td1.textContent = r.name;
      const td2 = document.createElement('td');
      td2.textContent = r.levels || "â€”";
      tr.appendChild(td1);
      tr.appendChild(td2);
      tbody.appendChild(tr);
    }

    table.appendChild(tbody);
    card.appendChild(table);
    groupGrid.appendChild(card);
  }
});
</script>
</body>
</html>
